/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { ChangeDetectionStrategy, ChangeDetectorRef, Component, EventEmitter, HostListener, Input, NgZone, Output } from '@angular/core';
import { ToastType } from '../toast-type';
import { Toast } from '../toast';
var ToastifyToastComponent = /** @class */ (function () {
    function ToastifyToastComponent(_cd, _zone) {
        this._cd = _cd;
        this._zone = _zone;
        this.autoClose = 5000;
        this.hideProgressBar = false;
        this.pauseOnHover = true;
        this.pauseOnVisibilityChange = true;
        this.closeOnClick = true;
        this.dismissEvent = new EventEmitter();
        this.ToastType = ToastType;
        this.running = false;
    }
    /**
     * @return {?}
     */
    ToastifyToastComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        this.autoCloseRemaining = this.autoClose;
        this.startTime = this.toast.time;
        // Do not start timer when toast is prompted while window is out of focus
        if (this.handleVisibilityChange && document.visibilityState === 'visible') {
            this.startCloseTimer();
        }
    };
    /**
     * @return {?}
     */
    ToastifyToastComponent.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        this.clearTimerTimeout();
    };
    /**
     * @return {?}
     */
    ToastifyToastComponent.prototype.startCloseTimer = /**
     * @return {?}
     */
    function () {
        var _this = this;
        if (this.running || !this.autoClose) {
            return;
        }
        this.startTime = new Date().getTime();
        this.running = true;
        this.autoDismissTimeout = this._zone.runOutsideAngular((/**
         * @return {?}
         */
        function () {
            return setTimeout((/**
             * @return {?}
             */
            function () {
                _this._zone.run((/**
                 * @return {?}
                 */
                function () {
                    _this.dismissEvent.emit();
                    _this._cd.markForCheck();
                }));
            }), _this.autoCloseRemaining);
        }));
    };
    /**
     * @return {?}
     */
    ToastifyToastComponent.prototype.pauseCloseTimer = /**
     * @return {?}
     */
    function () {
        this.running = false;
        this.clearTimerTimeout();
        // Calculate the elapsed time, subtract remaining time
        this.pauseTime = new Date().getTime();
        /** @type {?} */
        var elapsed = this.pauseTime - this.startTime;
        this.autoCloseRemaining -= elapsed;
    };
    /**
     * @return {?}
     */
    ToastifyToastComponent.prototype.clearTimerTimeout = /**
     * @return {?}
     */
    function () {
        if (this.autoDismissTimeout !== undefined) {
            clearTimeout(this.autoDismissTimeout);
        }
    };
    /**
     * @return {?}
     */
    ToastifyToastComponent.prototype.handleDismissButtonAction = /**
     * @return {?}
     */
    function () {
        if (this.closeOnClick) {
            return; // Let the other event handle the dismissal
        }
        this.clearTimerTimeout();
        this.dismissEvent.emit();
    };
    /**
     * @return {?}
     */
    ToastifyToastComponent.prototype.handleHostClick = /**
     * @return {?}
     */
    function () {
        if (this.closeOnClick) {
            this.clearTimerTimeout();
            this.dismissEvent.emit();
        }
    };
    /**
     * @return {?}
     */
    ToastifyToastComponent.prototype.handleMouseEnter = /**
     * @return {?}
     */
    function () {
        if (this.pauseOnHover) {
            this.pauseCloseTimer();
        }
    };
    /**
     * @return {?}
     */
    ToastifyToastComponent.prototype.handleMouseLeave = /**
     * @return {?}
     */
    function () {
        if (this.pauseOnHover) {
            this.startCloseTimer();
        }
    };
    /**
     * @return {?}
     */
    ToastifyToastComponent.prototype.handleVisibilityChange = /**
     * @return {?}
     */
    function () {
        if (!this.pauseOnVisibilityChange) {
            return;
        }
        if (document.visibilityState !== 'visible') {
            this.pauseCloseTimer();
            this._cd.detectChanges();
        }
        else {
            this.startCloseTimer();
        }
    };
    ToastifyToastComponent.decorators = [
        { type: Component, args: [{
                    // tslint:disable-next-line:component-selector
                    selector: 'lib-toastify-toast',
                    template: "<div role=\"alert\" class=\"toast-body\">\n    <div class=\"icon-container\">\n        <span *ngIf=\"iconLibrary == 'material'\" [ngSwitch]=\"toast.type\">\n            <i class=\"material-icons\" *ngSwitchCase=\"ToastType.info\">info_outline</i>\n            <i class=\"material-icons\" *ngSwitchCase=\"ToastType.default\">info_outline</i>\n            <i class=\"material-icons\" *ngSwitchCase=\"ToastType.warning\">warning_outline</i>\n            <i class=\"material-icons\" *ngSwitchCase=\"ToastType.error\">error_outline</i>\n            <i class=\"material-icons\" *ngSwitchCase=\"ToastType.success\">done</i>\n        </span>\n        <span *ngIf=\"iconLibrary == 'font-awesome'\" [ngSwitch]=\"toast.type\">\n            <i *ngSwitchCase=\"ToastType.info\" class=\"fa fa-info\"></i>\n            <i *ngSwitchCase=\"ToastType.default\" class=\"fa fa-info\"></i>\n            <i *ngSwitchCase=\"ToastType.warning\" class=\"fa fa-exclamation-triangle\"></i>\n            <i *ngSwitchCase=\"ToastType.error\" class=\"fa fa-exclamation\"></i>\n            <i *ngSwitchCase=\"ToastType.success\" class=\"fa fa-check\"></i>\n        </span>\n    </div>\n    <div class=\"toast-container\">\n        <span>{{toast.message}}</span>\n    </div>\n</div>\n<button (click)=\"handleDismissButtonAction()\" class=\"close-button close-button--{{ToastType[toast.type]}}\" type=\"button\" aria-label=\"close\">\u2716</button>\n<div *ngIf=\"!hideProgressBar\" class=\"progress-bar progress-bar--{{ToastType[toast.type]}}\"\n    [style.animation-play-state]=\"running? 'running' : 'paused'\" [style.animation-duration]=\"this.autoClose + 'ms'\" style=\"opacity: 1;\"></div>",
                    changeDetection: ChangeDetectionStrategy.OnPush,
                    styles: [".toast{position:relative;min-height:64px;box-sizing:border-box;margin-bottom:1rem;padding:8px;border-radius:1px;box-shadow:0 1px 10px 0 rgba(0,0,0,.1),0 2px 15px 0 rgba(0,0,0,.05);display:flex;justify-content:space-between;max-height:800px;overflow:hidden;font-family:sans-serif;cursor:pointer;direction:ltr}.toast--rtl{direction:rtl}.toast--default{background:#fff;color:#aaa}.toast--info{background:#3498db}.toast--success{background:#07bc0c}.toast--warning{background:#f1c40f}.toast--error{background:#e74c3c}.toast-body{margin:auto 0;flex:1;vertical-align:middle}@media only screen and (max-width :480px){.toast{margin-bottom:0}}.close-button{color:#fff;font-weight:700;font-size:14px;background:0 0;outline:0;border:none;padding:0;cursor:pointer;opacity:.7;transition:.3s;align-self:flex-start}.close-button--default{color:#000;opacity:.3}.close-button:focus,.close-button:hover{opacity:1}@-webkit-keyframes trackProgress{0%{-webkit-transform:scaleX(1);transform:scaleX(1)}100%{-webkit-transform:scaleX(0);transform:scaleX(0)}}@keyframes trackProgress{0%{-webkit-transform:scaleX(1);transform:scaleX(1)}100%{-webkit-transform:scaleX(0);transform:scaleX(0)}}.progress-bar{position:absolute;bottom:0;left:0;width:100%;height:5px;z-index:9999;opacity:.7;background-color:rgba(255,255,255,.7);-webkit-transform-origin:left;transform-origin:left;-webkit-animation:linear forwards trackProgress;animation:linear forwards trackProgress}.progress-bar--animated{-webkit-animation:linear forwards trackProgress;animation:linear forwards trackProgress}.progress-bar--controlled{transition:transform .2s;transition:transform .2s,-webkit-transform .2s}.progress-bar--rtl{right:0;left:initial;-webkit-transform-origin:right;transform-origin:right}.progress-bar--default{background:linear-gradient(to right,#4cd964,#5ac8fa,#007aff,#34aadc,#5856d6,#ff2d55)}.icon-container{display:inline-block;width:25px;vertical-align:middle}.icon-container span{margin-right:.5rem;display:inline-block;text-align:center;width:20px}.icon-container span i{vertical-align:middle}.fa,.material-icons{font-size:18px}.toast-container{display:inline-block;width:calc(100% - 25px);vertical-align:middle}"]
                }] }
    ];
    /** @nocollapse */
    ToastifyToastComponent.ctorParameters = function () { return [
        { type: ChangeDetectorRef },
        { type: NgZone }
    ]; };
    ToastifyToastComponent.propDecorators = {
        autoClose: [{ type: Input }],
        hideProgressBar: [{ type: Input }],
        pauseOnHover: [{ type: Input }],
        pauseOnVisibilityChange: [{ type: Input }],
        closeOnClick: [{ type: Input }],
        toast: [{ type: Input }],
        iconLibrary: [{ type: Input }],
        dismissEvent: [{ type: Output }],
        handleHostClick: [{ type: HostListener, args: ['click',] }],
        handleMouseEnter: [{ type: HostListener, args: ['mouseenter',] }],
        handleMouseLeave: [{ type: HostListener, args: ['mouseleave',] }],
        handleVisibilityChange: [{ type: HostListener, args: ['document:visibilitychange',] }]
    };
    return ToastifyToastComponent;
}());
export { ToastifyToastComponent };
if (false) {
    /** @type {?} */
    ToastifyToastComponent.prototype.autoClose;
    /** @type {?} */
    ToastifyToastComponent.prototype.hideProgressBar;
    /** @type {?} */
    ToastifyToastComponent.prototype.pauseOnHover;
    /** @type {?} */
    ToastifyToastComponent.prototype.pauseOnVisibilityChange;
    /** @type {?} */
    ToastifyToastComponent.prototype.closeOnClick;
    /** @type {?} */
    ToastifyToastComponent.prototype.toast;
    /** @type {?} */
    ToastifyToastComponent.prototype.iconLibrary;
    /** @type {?} */
    ToastifyToastComponent.prototype.dismissEvent;
    /**
     * @type {?}
     * @private
     */
    ToastifyToastComponent.prototype.autoDismissTimeout;
    /**
     * @type {?}
     * @private
     */
    ToastifyToastComponent.prototype.autoCloseRemaining;
    /**
     * @type {?}
     * @private
     */
    ToastifyToastComponent.prototype.pauseTime;
    /**
     * @type {?}
     * @private
     */
    ToastifyToastComponent.prototype.startTime;
    /** @type {?} */
    ToastifyToastComponent.prototype.ToastType;
    /** @type {?} */
    ToastifyToastComponent.prototype.running;
    /**
     * @type {?}
     * @private
     */
    ToastifyToastComponent.prototype._cd;
    /**
     * @type {?}
     * @private
     */
    ToastifyToastComponent.prototype._zone;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidG9hc3RpZnktdG9hc3QuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vYW5ndWxhci10b2FzdGlmeS8iLCJzb3VyY2VzIjpbImxpYi90b2FzdGlmeS10b2FzdC90b2FzdGlmeS10b2FzdC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFDTCx1QkFBdUIsRUFBRSxpQkFBaUIsRUFBRSxTQUFTLEVBQUUsWUFBWSxFQUFFLFlBQVksRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFxQixNQUFNLEVBQzVILE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDMUMsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLFVBQVUsQ0FBQztBQUVqQztJQTRCRSxnQ0FBb0IsR0FBc0IsRUFBVSxLQUFhO1FBQTdDLFFBQUcsR0FBSCxHQUFHLENBQW1CO1FBQVUsVUFBSyxHQUFMLEtBQUssQ0FBUTtRQW5CeEQsY0FBUyxHQUFHLElBQUksQ0FBQztRQUNqQixvQkFBZSxHQUFHLEtBQUssQ0FBQztRQUN4QixpQkFBWSxHQUFHLElBQUksQ0FBQztRQUNwQiw0QkFBdUIsR0FBRyxJQUFJLENBQUM7UUFDL0IsaUJBQVksR0FBRyxJQUFJLENBQUM7UUFJbkIsaUJBQVksR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO1FBUTVDLGNBQVMsR0FBRyxTQUFTLENBQUM7UUFDdEIsWUFBTyxHQUFHLEtBQUssQ0FBQztJQUdoQixDQUFDOzs7O0lBRUQseUNBQVE7OztJQUFSO1FBQ0UsSUFBSSxDQUFDLGtCQUFrQixHQUFHLElBQUksQ0FBQyxTQUFTLENBQUM7UUFDekMsSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQztRQUNqQyx5RUFBeUU7UUFDekUsSUFBSSxJQUFJLENBQUMsc0JBQXNCLElBQUksUUFBUSxDQUFDLGVBQWUsS0FBSyxTQUFTLEVBQUU7WUFD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OEM7b0JBRTlDLGVBQWUsRUFBRSx1QkFBdUIsQ0FBQyxNQUFNOztpQkFDaEQ7Ozs7Z0JBWDBCLGlCQUFpQjtnQkFBZ0QsTUFBTTs7OzRCQWMvRixLQUFLO2tDQUNMLEtBQUs7K0JBQ0wsS0FBSzswQ0FDTCxLQUFLOytCQUNMLEtBQUs7d0JBQ0wsS0FBSzs4QkFDTCxLQUFLOytCQUVMLE1BQU07a0NBb0VOLFlBQVksU0FBQyxPQUFPO21DQVFwQixZQUFZLFNBQUMsWUFBWTttQ0FPekIsWUFBWSxTQUFDLFlBQVk7eUNBT3pCLFlBQVksU0FBQywyQkFBMkI7O0lBYTNDLDZCQUFDO0NBQUEsQUF4SEQsSUF3SEM7U0FqSFksc0JBQXNCOzs7SUFFakMsMkNBQTBCOztJQUMxQixpREFBaUM7O0lBQ2pDLDhDQUE2Qjs7SUFDN0IseURBQXdDOztJQUN4Qyw4Q0FBNkI7O0lBQzdCLHVDQUFzQjs7SUFDdEIsNkNBQTJEOztJQUUzRCw4Q0FBNEM7Ozs7O0lBRTVDLG9EQUFnQzs7Ozs7SUFDaEMsb0RBQW1DOzs7OztJQUVuQywyQ0FBMEI7Ozs7O0lBQzFCLDJDQUEwQjs7SUFFMUIsMkNBQXNCOztJQUN0Qix5Q0FBZ0I7Ozs7O0lBRUoscUNBQThCOzs7OztJQUFFLHVDQUFxQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LCBDaGFuZ2VEZXRlY3RvclJlZiwgQ29tcG9uZW50LCBFdmVudEVtaXR0ZXIsIEhvc3RMaXN0ZW5lciwgSW5wdXQsIE5nWm9uZSwgT25EZXN0cm95LCBPbkluaXQsIE91dHB1dFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IFRvYXN0VHlwZSB9IGZyb20gJy4uL3RvYXN0LXR5cGUnO1xuaW1wb3J0IHsgVG9hc3QgfSBmcm9tICcuLi90b2FzdCc7XG5cbkBDb21wb25lbnQoe1xuICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6Y29tcG9uZW50LXNlbGVjdG9yXG4gIHNlbGVjdG9yOiAnbGliLXRvYXN0aWZ5LXRvYXN0JyxcbiAgdGVtcGxhdGVVcmw6ICcuL3RvYXN0aWZ5LXRvYXN0LmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJy4vdG9hc3RpZnktdG9hc3QuY29tcG9uZW50LnNjc3MnXSxcbiAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2hcbn0pXG5leHBvcnQgY2xhc3MgVG9hc3RpZnlUb2FzdENvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25EZXN0cm95IHtcblxuICBASW5wdXQoKSBhdXRvQ2xvc2UgPSA1MDAwO1xuICBASW5wdXQoKSBoaWRlUHJvZ3Jlc3NCYXIgPSBmYWxzZTtcbiAgQElucHV0KCkgcGF1c2VPbkhvdmVyID0gdHJ1ZTtcbiAgQElucHV0KCkgcGF1c2VPblZpc2liaWxpdHlDaGFuZ2UgPSB0cnVlO1xuICBASW5wdXQoKSBjbG9zZU9uQ2xpY2sgPSB0cnVlO1xuICBASW5wdXQoKSB0b2FzdDogVG9hc3Q7XG4gIEBJbnB1dCgpIGljb25MaWJyYXJ5OiAnbWF0ZXJpYWwnIHwgJ2ZvbnQtYXdlc29tZScgfCAnbm9uZSc7XG5cbiAgQE91dHB1dCgpIGRpc21pc3NFdmVudCA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcblxuICBwcml2YXRlIGF1dG9EaXNtaXNzVGltZW91dDogYW55O1xuICBwcml2YXRlIGF1dG9DbG9zZVJlbWFpbmluZzogbnVtYmVyO1xuXG4gIHByaXZhdGUgcGF1c2VUaW1lOiBudW1iZXI7XG4gIHByaXZhdGUgc3RhcnRUaW1lOiBudW1iZXI7XG5cbiAgVG9hc3RUeXBlID0gVG9hc3RUeXBlO1xuICBydW5uaW5nID0gZmFsc2U7XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBfY2Q6IENoYW5nZURldGVjdG9yUmVmLCBwcml2YXRlIF96b25lOiBOZ1pvbmUpIHtcbiAgfVxuXG4gIG5nT25Jbml0KCk6IHZvaWQge1xuICAgIHRoaXMuYXV0b0Nsb3NlUmVtYWluaW5nID0gdGhpcy5hdXRvQ2xvc2U7XG4gICAgdGhpcy5zdGFydFRpbWUgPSB0aGlzLnRvYXN0LnRpbWU7XG4gICAgLy8gRG8gbm90IHN0YXJ0IHRpbWVyIHdoZW4gdG9hc3QgaXMgcHJvbXB0ZWQgd2hpbGUgd2luZG93IGlzIG91dCBvZiBmb2N1c1xuICAgIGlmICh0aGlzLmhhbmRsZVZpc2liaWxpdHlDaGFuZ2UgJiYgZG9jdW1lbnQudmlzaWJpbGl0eVN0YXRlID09PSAndmlzaWJsZScpIHtcbiAgICAgIHRoaXMuc3RhcnRDbG9zZVRpbWVyKCk7XG4gICAgfVxuICB9XG5cbiAgbmdPbkRlc3Ryb3koKTogdm9pZCB7XG4gICAgdGhpcy5jbGVhclRpbWVyVGltZW91dCgpO1xuICB9XG5cbiAgc3RhcnRDbG9zZVRpbWVyKCk6IHZvaWQge1xuICAgIGlmICh0aGlzLnJ1bm5pbmcgfHwgIXRoaXMuYXV0b0Nsb3NlKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5zdGFydFRpbWUgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcbiAgICB0aGlzLnJ1bm5pbmcgPSB0cnVlO1xuICAgIHRoaXMuYXV0b0Rpc21pc3NUaW1lb3V0ID0gdGhpcy5fem9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PlxuICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIHRoaXMuX3pvbmUucnVuKCgpID0+IHtcbiAgICAgICAgICB0aGlzLmRpc21pc3NFdmVudC5lbWl0KCk7XG4gICAgICAgICAgdGhpcy5fY2QubWFya0ZvckNoZWNrKCk7XG4gICAgICAgIH0pO1xuICAgICAgfSwgdGhpcy5hdXRvQ2xvc2VSZW1haW5pbmcpKTtcbiAgfVxuXG4gIHBhdXNlQ2xvc2VUaW1lcigpOiB2b2lkIHtcbiAgICB0aGlzLnJ1bm5pbmcgPSBmYWxzZTtcbiAgICB0aGlzLmNsZWFyVGltZXJUaW1lb3V0KCk7XG5cbiAgICAvLyBDYWxjdWxhdGUgdGhlIGVsYXBzZWQgdGltZSwgc3VidHJhY3QgcmVtYWluaW5nIHRpbWVcbiAgICB0aGlzLnBhdXNlVGltZSA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xuICAgIGNvbnN0IGVsYXBzZWQgPSB0aGlzLnBhdXNlVGltZSAtIHRoaXMuc3RhcnRUaW1lO1xuICAgIHRoaXMuYXV0b0Nsb3NlUmVtYWluaW5nIC09IGVsYXBzZWQ7XG4gIH1cblxuICBjbGVhclRpbWVyVGltZW91dCgpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5hdXRvRGlzbWlzc1RpbWVvdXQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuYXV0b0Rpc21pc3NUaW1lb3V0KTtcbiAgICB9XG4gIH1cblxuICBoYW5kbGVEaXNtaXNzQnV0dG9uQWN0aW9uKCk6IHZvaWQge1xuICAgIGlmICh0aGlzLmNsb3NlT25DbGljaykge1xuICAgICAgcmV0dXJuOyAvLyBMZXQgdGhlIG90aGVyIGV2ZW50IGhhbmRsZSB0aGUgZGlzbWlzc2FsXG4gICAgfVxuXG4gICAgdGhpcy5jbGVhclRpbWVyVGltZW91dCgpO1xuICAgIHRoaXMuZGlzbWlzc0V2ZW50LmVtaXQoKTtcbiAgfVxuXG4gIEBIb3N0TGlzdGVuZXIoJ2NsaWNrJylcbiAgaGFuZGxlSG9zdENsaWNrKCk6IHZvaWQge1xuICAgIGlmICh0aGlzLmNsb3NlT25DbGljaykge1xuICAgICAgdGhpcy5jbGVhclRpbWVyVGltZW91dCgpO1xuICAgICAgdGhpcy5kaXNtaXNzRXZlbnQuZW1pdCgpO1xuICAgIH1cbiAgfVxuXG4gIEBIb3N0TGlzdGVuZXIoJ21vdXNlZW50ZXInKVxuICBoYW5kbGVNb3VzZUVudGVyKCk6IHZvaWQge1xuICAgIGlmICh0aGlzLnBhdXNlT25Ib3Zlcikge1xuICAgICAgdGhpcy5wYXVzZUNsb3NlVGltZXIoKTtcbiAgICB9XG4gIH1cblxuICBASG9zdExpc3RlbmVyKCdtb3VzZWxlYXZlJylcbiAgaGFuZGxlTW91c2VMZWF2ZSgpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5wYXVzZU9uSG92ZXIpIHtcbiAgICAgIHRoaXMuc3RhcnRDbG9zZVRpbWVyKCk7XG4gICAgfVxuICB9XG5cbiAgQEhvc3RMaXN0ZW5lcignZG9jdW1lbnQ6dmlzaWJpbGl0eWNoYW5nZScpXG4gIGhhbmRsZVZpc2liaWxpdHlDaGFuZ2UoKTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLnBhdXNlT25WaXNpYmlsaXR5Q2hhbmdlKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKGRvY3VtZW50LnZpc2liaWxpdHlTdGF0ZSAhPT0gJ3Zpc2libGUnKSB7XG4gICAgICB0aGlzLnBhdXNlQ2xvc2VUaW1lcigpO1xuICAgICAgdGhpcy5fY2QuZGV0ZWN0Q2hhbmdlcygpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnN0YXJ0Q2xvc2VUaW1lcigpO1xuICAgIH1cbiAgfVxufVxuIl19